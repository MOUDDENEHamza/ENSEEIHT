{"version":3,"file":"cdk-observers.umd.js","sources":["../../../../../src/cdk/observers/observe-content.ts","../../../../../src/cdk/observers/public-api.ts","../../../../../src/cdk/observers/index.ts"],"names":["Injectable","coerceElement","Observable","Subject","EventEmitter","coerceBooleanProperty","coerceNumberProperty","debounceTime","Directive","ElementRef","NgZone","Output","Input","NgModule"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {\n  coerceBooleanProperty,\n  coerceNumberProperty,\n  coerceElement,\n  BooleanInput,\n  NumberInput\n} from '@angular/cdk/coercion';\nimport {\n  AfterContentInit,\n  Directive,\n  ElementRef,\n  EventEmitter,\n  Injectable,\n  Input,\n  NgModule,\n  NgZone,\n  OnDestroy,\n  Output,\n} from '@angular/core';\nimport {Observable, Subject, Subscription, Observer} from 'rxjs';\nimport {debounceTime} from 'rxjs/operators';\n\n/**\n * Factory that creates a new MutationObserver and allows us to stub it out in unit tests.\n * @docs-private\n */\n@Injectable({providedIn: 'root'})\nexport class MutationObserverFactory {\n  create(callback: MutationCallback): MutationObserver | null {\n    return typeof MutationObserver === 'undefined' ? null : new MutationObserver(callback);\n  }\n}\n\n\n/** An injectable service that allows watching elements for changes to their content. */\n@Injectable({providedIn: 'root'})\nexport class ContentObserver implements OnDestroy {\n  /** Keeps track of the existing MutationObservers so they can be reused. */\n  private _observedElements = new Map<Element, {\n    observer: MutationObserver | null,\n    stream: Subject<MutationRecord[]>,\n    count: number\n  }>();\n\n  constructor(private _mutationObserverFactory: MutationObserverFactory) {}\n\n  ngOnDestroy() {\n    this._observedElements.forEach((_, element) => this._cleanupObserver(element));\n  }\n\n  /**\n   * Observe content changes on an element.\n   * @param element The element to observe for content changes.\n   */\n  observe(element: Element): Observable<MutationRecord[]>;\n\n  /**\n   * Observe content changes on an element.\n   * @param element The element to observe for content changes.\n   */\n  observe(element: ElementRef<Element>): Observable<MutationRecord[]>;\n\n  observe(elementOrRef: Element | ElementRef<Element>): Observable<MutationRecord[]> {\n    const element = coerceElement(elementOrRef);\n\n    return new Observable((observer: Observer<MutationRecord[]>) => {\n      const stream = this._observeElement(element);\n      const subscription = stream.subscribe(observer);\n\n      return () => {\n        subscription.unsubscribe();\n        this._unobserveElement(element);\n      };\n    });\n  }\n\n  /**\n   * Observes the given element by using the existing MutationObserver if available, or creating a\n   * new one if not.\n   */\n  private _observeElement(element: Element): Subject<MutationRecord[]> {\n    if (!this._observedElements.has(element)) {\n      const stream = new Subject<MutationRecord[]>();\n      const observer = this._mutationObserverFactory.create(mutations => stream.next(mutations));\n      if (observer) {\n        observer.observe(element, {\n          characterData: true,\n          childList: true,\n          subtree: true\n        });\n      }\n      this._observedElements.set(element, {observer, stream, count: 1});\n    } else {\n      this._observedElements.get(element)!.count++;\n    }\n    return this._observedElements.get(element)!.stream;\n  }\n\n  /**\n   * Un-observes the given element and cleans up the underlying MutationObserver if nobody else is\n   * observing this element.\n   */\n  private _unobserveElement(element: Element) {\n    if (this._observedElements.has(element)) {\n      this._observedElements.get(element)!.count--;\n      if (!this._observedElements.get(element)!.count) {\n        this._cleanupObserver(element);\n      }\n    }\n  }\n\n  /** Clean up the underlying MutationObserver for the specified element. */\n  private _cleanupObserver(element: Element) {\n    if (this._observedElements.has(element)) {\n      const {observer, stream} = this._observedElements.get(element)!;\n      if (observer) {\n        observer.disconnect();\n      }\n      stream.complete();\n      this._observedElements.delete(element);\n    }\n  }\n}\n\n\n/**\n * Directive that triggers a callback whenever the content of\n * its associated element has changed.\n */\n@Directive({\n  selector: '[cdkObserveContent]',\n  exportAs: 'cdkObserveContent',\n})\nexport class CdkObserveContent implements AfterContentInit, OnDestroy {\n  /** Event emitted for each change in the element's content. */\n  @Output('cdkObserveContent') event = new EventEmitter<MutationRecord[]>();\n\n  /**\n   * Whether observing content is disabled. This option can be used\n   * to disconnect the underlying MutationObserver until it is needed.\n   */\n  @Input('cdkObserveContentDisabled')\n  get disabled() { return this._disabled; }\n  set disabled(value: any) {\n    this._disabled = coerceBooleanProperty(value);\n    this._disabled ? this._unsubscribe() : this._subscribe();\n  }\n  private _disabled = false;\n\n  /** Debounce interval for emitting the changes. */\n  @Input()\n  get debounce(): number { return this._debounce; }\n  set debounce(value: number) {\n    this._debounce = coerceNumberProperty(value);\n    this._subscribe();\n  }\n  private _debounce: number;\n\n  private _currentSubscription: Subscription | null = null;\n\n  constructor(private _contentObserver: ContentObserver,\n              private _elementRef: ElementRef<HTMLElement>,\n              private _ngZone: NgZone) {}\n\n  ngAfterContentInit() {\n    if (!this._currentSubscription && !this.disabled) {\n      this._subscribe();\n    }\n  }\n\n  ngOnDestroy() {\n    this._unsubscribe();\n  }\n\n  private _subscribe() {\n    this._unsubscribe();\n    const stream = this._contentObserver.observe(this._elementRef);\n\n    // TODO(mmalerba): We shouldn't be emitting on this @Output() outside the zone.\n    // Consider brining it back inside the zone next time we're making breaking changes.\n    // Bringing it back inside can cause things like infinite change detection loops and changed\n    // after checked errors if people's code isn't handling it properly.\n    this._ngZone.runOutsideAngular(() => {\n      this._currentSubscription =\n          (this.debounce ? stream.pipe(debounceTime(this.debounce)) : stream).subscribe(this.event);\n    });\n  }\n\n  private _unsubscribe() {\n    this._currentSubscription?.unsubscribe();\n  }\n\n  static ngAcceptInputType_disabled: BooleanInput;\n  static ngAcceptInputType_debounce: NumberInput;\n}\n\n\n@NgModule({\n  exports: [CdkObserveContent],\n  declarations: [CdkObserveContent],\n  providers: [MutationObserverFactory]\n})\nexport class ObserversModule {}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nexport * from './observe-content';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"]}